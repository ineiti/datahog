<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Phase 2 - Block System</title>
        <link rel="stylesheet" href="./styles.css" />
    </head>
    <body>
        <div class="header">
            <h1>Phase 2: Block System</h1>
            <p>Testing: Multiple block types with auto-conversion</p>
        </div>

        <div class="instructions">
            <h3>Try these features:</h3>
            <ul>
                <li>
                    Type <code># </code> at the start to create a heading (# to
                    ######)
                </li>
                <li>
                    Type <code>- </code> or <code>* </code> at the start to
                    create an unordered list
                </li>
                <li>
                    Type <code>1. </code> at the start to create an ordered list
                </li>
                <li>
                    Press <code>Tab</code> in a list item to indent (nest) it
                </li>
                <li>
                    Press <code>Shift+Tab</code> in a list item to unindent it
                </li>
                <li>Press <code>Enter</code> to create a new block</li>
                <li>
                    Use <code>Arrow Up/Down</code> to navigate within
                    soft-wrapped lines before moving between blocks
                </li>
                <li>
                    Click on any block to activate it and see the markdown
                    syntax
                </li>
                <li>Click outside to deactivate and see the rendered HTML</li>
            </ul>
        </div>

        <div id="editor" class="editor-container"></div>

        <div class="controls">
            <button id="save">Save (log to console)</button>
            <button id="load">Load Sample</button>
            <button id="clear">Clear</button>
        </div>

        <div class="output">
            <h3>Saved Markdown:</h3>
            <pre id="state-output"></pre>
        </div>

        <script type="module">
            // Import CSS file - vite will process this
            import "../dist/md-editor.css";

            import { MarkdownEditor } from "../dist/index.mjs";
            import {
                ParagraphBlock,
                HeadingBlock,
                UnorderedListBlock,
                OrderedListBlock,
            } from "../dist/plugins/blocks/index.mjs";

            // Sample markdown with different block types
            const sampleMarkdown = `# Welcome to Phase 2

This is a paragraph block.

## Block Types

We now support multiple block types:

- Headings (levels 1-6)
- Paragraphs
- Unordered lists
  - With nested items
  - At multiple levels
- Ordered lists

### Auto-conversion

Type these markers at the start of a line:

1. # for heading level 1
2. ## for heading level 2
3. ### for heading level 3
4. - for unordered list
5. * also for unordered list
6. 1. for ordered list

#### Nested Lists

You can use Tab to indent list items:

- Top level item
  - Nested item
    - Deeply nested item
  - Another nested item
- Back to top level

Ordered lists can be nested too:

1. First step
   1. Sub-step A
   2. Sub-step B
2. Second step
   1. Sub-step A
      1. Detailed instruction
      2. Another detail
   2. Sub-step B
3. Third step

#### Mixed Content

You can mix different block types freely.

- Item 1
- Item 2
- Item 3

And continue with paragraphs.

### Soft Wrap Navigation Testing

This is a very long paragraph that will definitely wrap to multiple lines on most screen widths. The purpose of this paragraph is to test the soft wrap navigation feature where cursor up and down keys should first navigate within the wrapped lines before moving to the previous or next block. This allows for more natural editing of long text blocks without jumping between blocks prematurely. Try placing your cursor in the middle of this paragraph and using the arrow up and down keys to navigate through the wrapped lines.

Long list items for testing:

- This is an extremely long list item that contains a lot of text and will surely wrap to multiple lines on typical screen widths. When you use the arrow up and down keys within this list item, the cursor should move through the wrapped lines first before jumping to the previous or next list item. This makes editing long list items much more natural and intuitive.
- Another long list item with substantial content that spans multiple visual lines. The soft wrap navigation feature should allow you to move the cursor up and down within this text block seamlessly, only moving to adjacent blocks when you reach the actual first or last visual line of the content.
- Short item
- Yet another very long list item to thoroughly test the navigation behavior. This one includes even more text to ensure that it wraps to at least three or four visual lines on most displays. The cursor navigation should feel smooth and natural as you move through each visual line within the block before transitioning to the next or previous block in the document structure.

### More Test Cases

A final long paragraph for comprehensive testing of the soft wrap navigation feature. This paragraph is intentionally verbose to ensure multiple line wraps occur naturally during the editing process. The implementation should handle all edge cases gracefully, including navigation at the very beginning and end of wrapped lines, as well as in the middle of long text spans. Feel free to edit this text and experiment with the arrow key navigation to verify that it behaves as expected.`;

            // Initialize editor for Phase 2
            const editor = new MarkdownEditor({
                holder: document.getElementById("editor"),
                tools: {
                    blocks: [
                        new ParagraphBlock(),
                        new HeadingBlock(),
                        new UnorderedListBlock(),
                        new OrderedListBlock(),
                    ],
                },
                data: sampleMarkdown,
                onChange: async (api, event) => {
                    // Auto-save and display current markdown
                    const markdown = await api.save();
                    document.getElementById("state-output").textContent =
                        markdown;
                },
                onReady: async (api) => {
                    // Display initial markdown
                    const markdown = await api.save();
                    document.getElementById("state-output").textContent =
                        markdown;
                },
            });

            // Hook up controls
            document.getElementById("save").onclick = async () => {
                const markdown = await editor.save();
                console.log("Saved markdown:", markdown);
            };

            document.getElementById("load").onclick = async () => {
                await editor.load(sampleMarkdown);
            };

            document.getElementById("clear").onclick = () => {
                editor.clear();
            };
        </script>
    </body>
</html>
